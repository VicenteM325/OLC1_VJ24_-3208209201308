package analisis;

//importaciones
import java_cup.runtime.Symbol;
import java.util.LinkedList;
import abstracto.Instruccion;
import simbolo.Tipo;
import simbolo.TipoDato;


//Instrucciones
import instrucciones.Print;

//Expresiones
import expresiones.Nativo;
import expresiones.Aritmeticas;
import expresiones.OperadoresAritmeticos;
import expresiones.*;



// parser
parser code
{:
    scanner s;
    parser(scanner s) { this.s = s;}


    public void syntax_erro(Symbol s){
        System.out.println("Error Sintatico en la linea " +
        (s.left) + " y columna " + (s.right) + 
        " No se esperaba el componente: " + (s.value) + ".");
    }

    public void unrecovered_syntax_error(Symbol s){
        System.out.println("Error Sintactico no recuperable en la linea " + 
        (s.left) + " y columna " + (s.right) + 
        ". No se esperaba el componente: " + (s.value) + ".");
    }
:}

action code 
{:

:}

terminal String CADENA,ENTERO, DECIMAL;
terminal FINCADENA, IMPRIMIR;
//terminal MAS, MENOS, MULTIPLICACION, DIVISION;
terminal PAR_A, PAR_C, MAS, MENOS, MULTIPLICACION,DIVISION,POTENCIA, MODULO, UMENOS;
terminal MENOR_QUE, MAYOR_QUE, DIFEREN, MENOR_IGUAL_QUE, IGUALACION, MAYOR_IGUAL_QUE;

nonterminal LinkedList<Instruccion> INICIO, INSTRUCCIONES;
nonterminal Instruccion INSTRUCCION;
nonterminal Instruccion EXPRESION;

precedence left MAS, MENOS;
precedence left MULTIPLICACION, DIVISION;
precedence left POTENCIA, MODULO;
precedence left UMENOS;
/*precedence left MAS, MENOS;
precedence left MULTIPLICACION, DIVISION;
precedence right UMENOS;
*/
start with INICIO;

INICIO ::= INSTRUCCIONES:a                                    {:  RESULT  = a;   :}
;
INSTRUCCIONES ::= INSTRUCCIONES:a INSTRUCCION:b             {:  RESULT = a; RESULT.add(b);  :}
                | INSTRUCCION:a                             {:  RESULT = new LinkedList<>(); RESULT.add(a); :}
;

INSTRUCCION ::= IMPRIMIR PAR_A EXPRESION:a PAR_C FINCADENA  {:  RESULT = new Print(a, aleft,aright); :}
                  
;

EXPRESION ::= MENOS EXPRESION:a {:   RESULT = new Aritmeticas(a,OperadoresAritmeticos.NEGACION, aleft, aright);    :}%prec UMENOS
            | EXPRESION:a MAS EXPRESION:b    {: RESULT = new Aritmeticas(a,b, OperadoresAritmeticos.SUMA, aleft, aright);   :}
            | EXPRESION:a MENOS EXPRESION:b  {: RESULT = new Aritmeticas(a,b, OperadoresAritmeticos.RESTA, aleft, aright);  :}
            | EXPRESION:a POTENCIA EXPRESION:b {: RESULT = new Aritmeticas(a,b,OperadoresAritmeticos.POTENCIA, aleft, aright);  :} %prec POTENCIA
            | EXPRESION:a MULTIPLICACION EXPRESION:b {: RESULT = new Aritmeticas(a,b,OperadoresAritmeticos.MULTIPLICACION, aleft, aright);  :}
            | EXPRESION:a DIVISION EXPRESION:b {: RESULT = new Aritmeticas(a,b,OperadoresAritmeticos.DIVISION, aleft, aright);  :}
            | EXPRESION:a MODULO EXPRESION:b {: RESULT = new Aritmeticas(a,b,OperadoresAritmeticos.MODULO, aleft, aright);  :}
            | ENTERO:a          {:  RESULT = new Nativo(Integer.parseInt(a), new Tipo(TipoDato.ENTERO),aleft, aright);  :}
            | DECIMAL:a         {:  RESULT = new Nativo(new Double(a), new Tipo(TipoDato.DECIMAL), aleft, aright); :}
            | CADENA:a          {:  RESULT = new Nativo(a, new Tipo(TipoDato.CADENA), aleft, aright);    :}
;






            /* 
            MENOS EXPRESION:a                         {:     RESULT = a *-1;  :} %prec UMENOS
            | EXPRESION:a MAS EXPRESION:b               {:     RESULT = a + b;  :}
            | EXPRESION:a MENOS EXPRESION:b             {:     RESULT = a - b;  :}
            | EXPRESION:a MULTIPLICACION EXPRESION:b    {:     RESULT = a * b;  :}
            | EXPRESION:a DIVISION EXPRESION:b          {:     RESULT = a / b;  :}
            | ENTERO:a                                  {:     RESULT = new Double(a);  :}
            | DECIMAL:a                                 {:     RESULT = new Double(a);  :}
            | PAR_A EXPRESION:a PAR_C                   {:     RESULT = a;  :}
;
*/


/*
    INICIO ::= INSRUCCIONES

    INSTRUCCIONES ::= INSTRUCCION

    INSTRUCCION ::= IMPRIMIR PAR_A EXPRESION PAR_C FINCADENA
    INSTRUCCION ::= IMPRIMIR PAR_A CADENA PAR_C FINCADENA
*/